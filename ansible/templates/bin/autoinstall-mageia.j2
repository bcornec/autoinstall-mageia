#!/bin/bash
#
# Launch the automatic installation of this Mageia node
#
set -e
set -u
set -o pipefail

exec &> >(tee $HOME/autoinstall-mageia.log)
# Check user is correct
MGAUSER=`id -u -n`
if [ _"$MGAUSER" != _"{{ MGAADMININS }}" ]; then
	echo "This script should be launched as user {{ MGAADMININS }}"
	exit -1
fi

# Get env var
source /etc/autoinstall-mageia.sh
# Clean old install
cd $HOME
rm -rf autoinstall-mageia 
# Reinstantiate
git clone https://github.com/bcornec/autoinstall-mageia.git
# Install as root
cd autoinstall-mageia/install
sudo ./install.sh -n $MGAMACHINETYPE -g production -f $MGAMACHINENAME -i $MGAMACHINEIP
